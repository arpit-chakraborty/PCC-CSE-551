# PL/SQL Assignments - Part 4

## 1. Initial Payment Insertion for New Accounts
**Question:** Write a PL/SQL block to check for accounts in the `ACCT_MSTR` table that do not have any records in the `TRANS_MSTR` table. For such accounts, insert an 'INITIAL PAYMENT' transaction. If the account type is 'SB', the amount should be 500; otherwise, it should be 2000.

```sql
EDIT PLSQL_ASSIGN4;

CREATE OR REPLACE FUNCTION F_CHKACCTNO(VACCT_NO VARCHAR2) RETURN NUMBER IS
	DUMMY VARCHAR2(10);
BEGIN
	SELECT DISTINCT ACCT_NO 
    INTO DUMMY 
    FROM TRANS_MSTR 
    WHERE ACCT_NO = VACCT_NO;

	RETURN 1;
EXCEPTION
	WHEN NO_DATA_FOUND THEN RETURN 0;
END;
/

DECLARE
	CURSOR C_ACCTS IS 
        SELECT ACCT_NO, TYPE 
        FROM ACCT_MSTR;

	MACCT_NO ACCT_MSTR.ACCT_NO%TYPE;
	MTYPE ACCT_MSTR.TYPE%TYPE;
	EXISTS_FLAG NUMBER(1);
    
    -- HELPER TO GENERATE NEXT TRANS_NO SIMPLY
    V_NEXT_TRANS_NO VARCHAR2(10);
BEGIN
	OPEN C_ACCTS;
	LOOP
		FETCH C_ACCTS INTO MACCT_NO, MTYPE;
		EXIT WHEN C_ACCTS%NOTFOUND;
        
		EXISTS_FLAG := F_CHKACCTNO(MACCT_NO);
        
		IF EXISTS_FLAG = 0 THEN
            -- CALCULATE NEXT TRANSACTION ID DYNAMICALLY
            SELECT 'T'||TO_CHAR(NVL(MAX(TO_NUMBER(SUBSTR(TRANS_NO, 2))), 0) + 1)
            INTO V_NEXT_TRANS_NO
            FROM TRANS_MSTR;

			IF MTYPE = 'SB' THEN
				INSERT INTO TRANS_MSTR (TRANS_NO, ACCT_NO, DT, TYPE, PARTICULAR, DR_CR, AMT, BALANCE) 
                VALUES(V_NEXT_TRANS_NO, MACCT_NO, SYSDATE, 'C', 'INITIAL PAYMENT', 'D', 500, 500);
			ELSE
				INSERT INTO TRANS_MSTR (TRANS_NO, ACCT_NO, DT, TYPE, PARTICULAR, DR_CR, AMT, BALANCE) 
                VALUES(V_NEXT_TRANS_NO, MACCT_NO, SYSDATE, 'C', 'INITIAL PAYMENT', 'D', 2000, 2000);
			END IF;
		END IF;
	END LOOP;
	CLOSE C_ACCTS;
	COMMIT;
END;
/

@PLSQL_ASSIGN4;
```